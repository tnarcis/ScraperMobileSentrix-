<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>History â€” MobileSentrix Extractor v8</title>
  <script>
    (function(){
      var storageKey = 'msx_theme';
      try {
        var stored = localStorage.getItem(storageKey);
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-bs-theme', theme);
        document.documentElement.dataset.theme = theme;
      } catch (error) {
        document.documentElement.setAttribute('data-bs-theme', 'dark');
      }
    })();
  </script>
  
  <!-- Inline Critical CSS to prevent FOUC -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html{font-size:16px}
  body{font-family:var(--font-sans,'Plus Jakarta Sans','Segoe UI',sans-serif);background:var(--page-bg,linear-gradient(180deg,#0a0e27 0%,#1a1f3a 100%));color:var(--text,#e8eaed);min-height:100vh;line-height:1.6}
  .page-shell{max-width:1400px;margin:0 auto;padding:var(--space-sm,1rem);opacity:0;animation:fadeIn .3s ease forwards}
    @keyframes fadeIn{to{opacity:1}}
    .top-bar,.cy-card{background:var(--panel,rgba(255,255,255,0.05));border-radius:16px;padding:1.5rem;border:1px solid var(--border,rgba(135,144,199,0.28));box-shadow:var(--shadow,0 4px 16px rgba(3,10,32,0.3))}
    .overlay{position:fixed;inset:0;background:var(--overlay-backdrop,rgba(10,14,39,0.95));display:flex;align-items:center;justify-content:center;z-index:9999}
    .d-none{display:none!important}
  </style>
  
  <!-- Resource Hints for faster loading -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  
  <!-- Preload critical CSS -->
  <link rel="preload" href="{{ url_for('static', filename='css/common.css') }}" as="style">
  <link rel="preload" href="{{ url_for('static', filename='css/history.css') }}" as="style">
  
  <!-- Critical CSS loaded synchronously -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/history.css') }}">
  
  <!-- Non-critical CSS loaded asynchronously -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}"></noscript>
  
  <!-- Fonts loaded asynchronously -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"></noscript>
</head>
<body class="grid-bg history-page">
  <div class="page-shell py-3">
    <header class="top-bar cy-card mb-3">
      <div class="header-main">
        <div>
          <h1 class="header-title">History</h1>
          <p class="header-subtitle">Browse previous fetch sessions</p>
        </div>
                        <nav class="nav-pills">
                    <a href="/" class="nav-link">Extractor</a>
                    <a href="/results" class="nav-link">Results</a>
                    <a href="/history" class="nav-link active">History</a>
                    <a href="/image-converter" class="nav-link">Images</a>
                    <a href="/instructions" class="nav-link">Instructions</a>
                </nav>
      </div>
      <div class="header-stats">
        <div class="switch-wrap">
          <label class="form-check-label" for="darkMode">Light</label>
          <div class="form-check form-switch m-0">
            <input class="form-check-input" type="checkbox" id="darkMode" checked>
          </div>
          <label class="form-check-label" for="darkMode">Dark</label>
        </div>
      </div>
    </header>

    <div id="alert" class="alert cy-card d-none p-3" role="alert"></div>

    <!-- Statistics Dashboard -->
    <section class="cy-card p-3 mb-3">
      <div class="section-heading mb-3">
        <h2 class="section-title">Database Overview</h2>
        <p class="section-subtitle">Real-time statistics from your scraping database</p>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-content">
            <div class="stat-value" id="totalHistories">-</div>
            <div class="stat-label">Total Sessions</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ›ï¸</div>
          <div class="stat-content">
            <div class="stat-value" id="totalItems">-</div>
            <div class="stat-label">Items Scraped</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ“±</div>
          <div class="stat-content">
            <div class="stat-value" id="uniqueModels">-</div>
            <div class="stat-label">Unique Models</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-content">
            <div class="stat-value" id="recentSessions">-</div>
            <div class="stat-label">Recent (30d)</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ’¾</div>
          <div class="stat-content">
            <div class="stat-value" id="dbSize">-</div>
            <div class="stat-label">Database Size</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸŒ</div>
          <div class="stat-content">
            <div class="stat-value" id="uniqueSites">-</div>
            <div class="stat-label">Sites Scraped</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-content">
            <div class="stat-value" id="avgPrice">-</div>
            <div class="stat-label">Avg Price</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">âœ…</div>
          <div class="stat-content">
            <div class="stat-value" id="successRate">-</div>
            <div class="stat-label">Success Rate</div>
          </div>
        </div>
        
        <div class="stat-card stat-card--highlight">
          <div class="stat-icon stat-icon--trophy">ğŸ†</div>
          <div class="stat-content">
            <div class="stat-value stat-value--large" id="topSite">-</div>
            <div class="stat-label">Top Site</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ“…</div>
          <div class="stat-content">
            <div class="stat-value" id="latestSession">-</div>
            <div class="stat-label">Latest Session</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"></div>
          <div class="stat-content">
            <div class="stat-value" id="highestPrice">-</div>
            <div class="stat-label">Highest Price</div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon">ğŸ“‰</div>
          <div class="stat-content">
            <div class="stat-value" id="lowestPrice">-</div>
            <div class="stat-label">Lowest Price</div>
          </div>
        </div>
      </div>
    </section>

    <!-- History List -->
    <section class="cy-card p-3">
      <div class="history-heading mb-3">
        <div>
          <h2 class="section-title">Fetch History</h2>
          <p class="section-subtitle">Browse and manage your scraping sessions</p>
        </div>
        <div class="history-heading__right">
          <div class="history-heading__utilities">
            <div class="history-control-chip" role="group" aria-label="History utilities">
              <div class="history-control-chip__actions">
                <button type="button" id="refreshBtn" class="history-control-chip__button history-control-chip__button--primary">
                  <span class="history-control-chip__icon" aria-hidden="true">ğŸ”„</span>
                  <span class="history-control-chip__label">Refresh</span>
                </button>
                <button type="button" id="cleanupBtn" class="history-control-chip__button history-control-chip__button--danger">
                  <span class="history-control-chip__icon" aria-hidden="true">ğŸ§¹</span>
                  <span class="history-control-chip__label">Cleanup Old</span>
                </button>
              </div>
              <span class="history-control-chip__divider" aria-hidden="true"></span>
              <div class="history-control-chip__meta" id="historyStatusCluster" role="list">
                <div class="history-control-chip__item" role="listitem" id="historyDateChip" title="Current date">
                  <span class="history-control-chip__meta-icon" aria-hidden="true">ğŸ“…</span>
                  <div class="history-control-chip__meta-text">
                    <span class="history-control-chip__meta-label">Date</span>
                    <span class="history-control-chip__meta-value" id="historyDateValue">â€”</span>
                  </div>
                </div>
                <div class="history-control-chip__item" role="listitem" id="historyTimeChip" title="Local time">
                  <span class="history-control-chip__meta-icon" aria-hidden="true">â±</span>
                  <div class="history-control-chip__meta-text">
                    <span class="history-control-chip__meta-label">Local Time</span>
                    <span class="history-control-chip__meta-value" id="historyTimeValue">â€”</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="history-filters mb-4">
        <div class="history-filter history-filter--full history-filter--search">
          <label for="historySearch" class="history-filter__label">Search Sessions</label>
          <input id="historySearch" type="text" class="history-filter__input" placeholder="Search by URL, site, or session ID">
        </div>
        <div class="history-filter">
          <label for="historyStartDate" class="history-filter__label">From Date</label>
          <input id="historyStartDate" type="date" class="history-filter__input">
        </div>
        <div class="history-filter">
          <label for="historyEndDate" class="history-filter__label">To Date</label>
          <input id="historyEndDate" type="date" class="history-filter__input">
        </div>
        <div class="history-filter history-filter--range">
          <label for="historyMinItems" class="history-filter__label">Minimum Items</label>
          <div class="history-range-control">
            <input id="historyMinItems" type="range" min="0" max="500" step="10" value="0">
            <span class="history-range-value" id="historyMinItemsValue">0</span>
          </div>
        </div>
        <div class="history-filter">
          <label for="historySiteSelect" class="history-filter__label">Site</label>
          <select id="historySiteSelect" class="history-filter__input">
            <option value="">All sites</option>
          </select>
        </div>
        <div class="history-filter history-filter--full history-filter--actions">
          <div class="history-filter__actions">
            <button type="button" id="historyClearFilters" class="btn btn-outline-secondary btn-ghost">Clear Filters</button>
            <span id="historyResultSummary" class="history-result-summary">â€”</span>
          </div>
        </div>
      </div>
      
      <div id="historyContainer">
        <!-- History entries will be populated here -->
      </div>

      <div id="emptyState" class="empty-state d-none">
        <div class="empty-glow"></div>
        <h3>No history yet</h3>
        <p>Start by <a href="/" style="color: var(--primary);">running a fetch</a> to see your sessions here.</p>
      </div>
    </section>
  </div>

  <!-- History Detail Modal -->
  <div id="historyModal" class="history-detail-modal">
    <div class="history-detail-content">
      <button class="close-btn" id="closeModal">&times;</button>
      <div id="modalContent">
        <!-- Detailed view will be populated here -->
      </div>
    </div>
  </div>

  <!-- Cleanup Modal -->
  <div id="cleanupModal" class="history-detail-modal">
    <div class="history-detail-content cleanup-modal-content">
      <button class="close-btn" id="closeCleanupModal">&times;</button>
      <div class="cleanup-modal-body">
        <h3 class="cleanup-modal-title">ğŸ§¹ Cleanup Old Sessions</h3>
        <p class="cleanup-modal-subtitle">Delete scraping sessions older than a specified date</p>
        
        <div class="cleanup-options">
          <div class="cleanup-option-group">
            <label class="cleanup-label">Quick Select</label>
            <div class="cleanup-quick-buttons">
              <button type="button" class="cleanup-quick-btn" data-days="30">Last 30 Days</button>
              <button type="button" class="cleanup-quick-btn" data-days="60">Last 60 Days</button>
              <button type="button" class="cleanup-quick-btn active" data-days="90">Last 90 Days</button>
              <button type="button" class="cleanup-quick-btn" data-days="180">Last 6 Months</button>
              <button type="button" class="cleanup-quick-btn" data-days="365">Last Year</button>
              <button type="button" class="cleanup-quick-btn cleanup-quick-btn--danger" data-days="99999">ğŸ—‘ï¸ Delete All</button>
            </div>
          </div>
          
          <div class="cleanup-option-group">
            <label for="cleanupDays" class="cleanup-label">Or Enter Custom Days</label>
            <input type="number" id="cleanupDays" class="cleanup-input" value="90" min="1" max="3650" placeholder="Number of days">
            <small class="cleanup-help">Sessions older than this will be deleted</small>
          </div>
          
          <div class="cleanup-option-group">
            <label for="cleanupDate" class="cleanup-label">Or Select Specific Date</label>
            <input type="date" id="cleanupDate" class="cleanup-input">
            <small class="cleanup-help">Delete all sessions before this date</small>
          </div>
          
          <div class="cleanup-preview" id="cleanupPreview">
            <div class="cleanup-preview-icon">âš ï¸</div>
            <div class="cleanup-preview-text">
              <strong>Action Preview:</strong>
              <span id="cleanupPreviewText">Sessions older than 90 days will be deleted</span>
            </div>
          </div>
        </div>
        
        <div class="cleanup-actions">
          <button type="button" id="cancelCleanup" class="btn btn-outline-secondary">Cancel</button>
          <button type="button" id="confirmCleanup" class="btn btn-danger">
            <span>ğŸ—‘ï¸</span>
            <span>Delete Old Sessions</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="overlay" class="overlay"><div class="spinner"></div></div>

  <!-- Custom Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col text-center">
          <!-- Footer content removed -->
        </div>
      </div>
    </div>
  </footer>

  <!-- Deferred JavaScript for non-blocking load -->
  <script defer src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script defer src="{{ url_for('static', filename='js/history.js') }}"></script>
</body>
</html>
