<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MobileSentrix Extractor ‚Äî v8</title>
  <script>
    (function(){
      var storageKey = 'msx_theme';
      try {
        var stored = localStorage.getItem(storageKey);
        var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-bs-theme', theme);
        document.documentElement.dataset.theme = theme;
      } catch (error) {
        document.documentElement.setAttribute('data-bs-theme', 'dark');
      }
    })();
  </script>
  
  <!-- Inline Critical CSS to prevent FOUC -->
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html{font-size:16px}
  body{font-family:var(--font-sans,'Plus Jakarta Sans','Segoe UI',sans-serif);background:var(--page-bg,linear-gradient(180deg,#0a0e27 0%,#1a1f3a 100%));color:var(--text,#e8eaed);min-height:100vh;line-height:1.6}
  .page-shell{max-width:1400px;margin:0 auto;padding:var(--space-sm,1rem);opacity:0;animation:fadeIn .3s ease forwards}
    @keyframes fadeIn{to{opacity:1}}
    .top-bar,.cy-card{background:var(--panel,rgba(255,255,255,0.05));border-radius:16px;padding:1.5rem;border:1px solid var(--border,rgba(135,144,199,0.28));box-shadow:var(--shadow,0 4px 16px rgba(3,10,32,0.3))}
    .overlay{position:fixed;inset:0;background:var(--overlay-backdrop,rgba(10,14,39,0.95));display:flex;align-items:center;justify-content:center;z-index:9999}
    .d-none{display:none!important}
  </style>
  
  <!-- Resource Hints for faster loading -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  
  <!-- Preload critical CSS -->
  <link rel="preload" href="{{ url_for('static', filename='css/common.css') }}" as="style">
  <link rel="preload" href="{{ url_for('static', filename='css/main.css') }}" as="style">
  
  <!-- Critical CSS loaded synchronously -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  
  <!-- Non-critical CSS loaded asynchronously -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/loading.css') }}" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="{{ url_for('static', filename='css/loading.css') }}"></noscript>
  
  <!-- Fonts loaded asynchronously -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"></noscript>

</head>
<body class="grid-bg extractor-page">
  <div class="page-shell py-3">
    <header class="top-bar cy-card mb-3">
      <div class="header-main">
        <div class="header-brand">
          <h1 class="header-title">MobileSentrix Extractor</h1>
          <p class="header-subtitle">Pricing &amp; watchlist cockpit</p>
        </div>
                        <nav class="nav-pills">
                    <a href="/" class="nav-link active">Extractor</a>
                    <a href="/results" class="nav-link">Results</a>
                    <a href="/history" class="nav-link">History</a>
                    <a href="/image-converter" class="nav-link">Images</a>
                    <a href="/instructions" class="nav-link">Instructions</a>
                </nav>
        <div class="header-stats">
          <div class="stat-item">
            <span class="stat-label">URLs Detected</span>
            <span class="stat-value" id="urlCount">0</span>
          </div>
          <div class="switch-wrap">
            <label class="form-check-label" for="darkMode">Light</label>
            <div class="form-check form-switch m-0">
              <input class="form-check-input" type="checkbox" id="darkMode" checked>
            </div>
            <label class="form-check-label" for="darkMode">Dark</label>
          </div>
        </div>
      </div>
    </header>

    <!-- Controls -->
    <section class="cy-card control-section">
      <!-- Primary Controls (Always Visible) -->
      <div class="primary-controls">
        <div class="section-heading">
          <div>
            <h2 class="section-title">Fetch Controls</h2>
            <p class="section-subtitle">Paste category or product URLs to fetch pricing data from supported sites.</p>
          </div>
        </div>
        
        <!-- URL Input Card -->
        <div class="url-input-section">
          <div class="url-input-card">
            <div class="input-header">
              <div class="input-icon">üîó</div>
              <div class="input-content">
                <div class="input-title">Target URLs</div>
                <div class="input-subtitle">Paste category or product URLs (one per line). Auto-crawls up to 20 pages.</div>
              </div>
            </div>
            <textarea id="urls" class="url-textarea" placeholder="https://www.mobilesentrix.ca/category/...&#10;https://www.mobilesentrix.com/products/...&#10;https://example.com/phones/..."></textarea>
          </div>
          
          <!-- Quick Action Bar -->
          <div class="quick-actions">
            <button id="runBtn" class="btn btn-primary btn-cy btn-fetch">
              <span class="btn-icon">‚ö°</span>
              <span class="btn-text">Start Fetch</span>
            </button>
            <button id="advancedToggle" class="btn btn-outline btn-cy btn-toggle" disabled>
              <span class="btn-icon">‚öôÔ∏è</span>
              <span class="btn-text">Advanced Filters</span>
              <span class="toggle-indicator">‚ñº</span>
            </button>
            <div class="status-cluster" id="statusCluster">
              <div class="status-chips" role="list">
                <span class="status-chip" role="listitem" id="dateChip" title="Current date">
                  <span class="status-chip__icon" aria-hidden="true">üìÖ</span>
                  <span class="status-chip__meta">
                    <span class="status-chip__label">Date</span>
                    <span class="status-chip__value" id="currentDateValue">‚Äî</span>
                  </span>
                </span>
                <span class="status-chip" role="listitem" id="timeChip" title="Local time">
                  <span class="status-chip__icon" aria-hidden="true">‚è±</span>
                  <span class="status-chip__meta">
                    <span class="status-chip__label">Local Time</span>
                    <span class="status-chip__value" id="currentTimeValue">‚Äî</span>
                  </span>
                </span>
              </div>
              <div class="url-status">
                <span class="status-indicator" id="urlStatus">Ready</span>
                <span class="url-count" id="urlCount">0 URLs</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Advanced Controls (Collapsible) -->
      <div class="advanced-controls" id="advancedControls" style="display: none;">
        <div class="advanced-header">
          <div class="section-toggle-header">
            <span class="section-icon">‚öôÔ∏è</span>
            <h3 class="section-heading">Advanced Filters</h3>
            <span class="filter-count" id="filterCount">0 filters active</span>
            <button class="reset-all-btn" id="resetAllBtn" title="Reset all filters">
              <span>‚ü≥</span>
            </button>
          </div>
          <p class="section-description">Quick adjust your pricing, limits, and filters below.</p>
        </div>
        
        <!-- Compact 2-Column Grid -->
        <div class="filter-grid">
          <!-- Pricing & Limits (Merged) -->
          <div class="filter-tile" data-category="pricing">
            <div class="tile-header">
              <span class="tile-icon">üí∞</span>
              <span class="tile-title">Pricing & Limits</span>
              <span class="active-indicator" id="pricingIndicator"></span>
            </div>
            <div class="tile-content">
              <div class="inline-controls">
                <div class="control-group">
                  <label class="floating-label">Discount %</label>
                  <input id="percent" type="number" class="compact-input" min="0" max="95" step="0.1" value="0">
                </div>
                <div class="control-group">
                  <label class="floating-label">Fixed $</label>
                  <input id="absOff" type="number" class="compact-input" min="0" step="0.01" value="0">
                </div>
                <div class="divider"></div>
                <div class="control-group">
                  <label class="floating-label">Min Price</label>
                  <input id="priceMin" type="number" class="compact-input" min="0" step="0.01" placeholder="0">
                </div>
                <div class="control-group">
                  <label class="floating-label">Max Price</label>
                  <input id="priceMax" type="number" class="compact-input" min="0" step="0.01" placeholder="">
                </div>
                <div class="divider"></div>
                <div class="control-group">
                  <label class="floating-label">Alert %</label>
                  <input id="dropPct" type="number" class="compact-input" min="1" max="90" step="1" value="10">
                </div>
              </div>
            </div>
          </div>

          <!-- Enhanced Keyword Filters -->
          <div class="filter-tile" data-category="keywords">
            <div class="tile-header">
              <span class="tile-icon">üîó</span>
              <span class="tile-title">Keywords</span>
              <span class="active-indicator" id="keywordsIndicator"></span>
            </div>
            <div class="tile-content">
              <div class="keyword-section">
                <div class="keyword-group">
                  <label class="keyword-label">Include</label>
                  <div class="keyword-input-wrapper">
                    <input id="kwInclude" class="keyword-input" placeholder="Type and press Enter">
                    <div class="keyword-chips" id="includeChips"></div>
                  </div>
                  <input type="hidden" id="include" name="include" />
                </div>
                <div class="keyword-group">
                  <label class="keyword-label">Exclude</label>
                  <div class="keyword-input-wrapper">
                    <input id="kwExclude" class="keyword-input" placeholder="Type and press Enter">
                    <div class="keyword-chips" id="excludeChips"></div>
                  </div>
                  <input type="hidden" id="exclude" name="exclude" />
                </div>
              </div>
            </div>
          </div>

          <!-- Modern Display Options -->
          <div class="filter-tile" data-category="display">
            <div class="tile-header">
              <span class="tile-icon">‚ö°</span>
              <span class="tile-title">Display Options</span>
              <span class="active-indicator" id="displayIndicator"></span>
            </div>
            <div class="tile-content">
              <div class="display-controls">
                <div class="control-row">
                  <label class="control-label">Sort by</label>
                  <select id="sortBy" class="modern-select">
                    <option value="none">Default</option>
                    <option value="final_asc">Price ‚Üë</option>
                    <option value="final_desc">Price ‚Üì</option>
                    <option value="orig_asc">Original ‚Üë</option>
                    <option value="orig_desc">Original ‚Üì</option>
                    <option value="disc_asc">Discount ‚Üë</option>
                    <option value="disc_desc">Discount ‚Üì</option>
                    <option value="title_asc">Title A‚ÜíZ</option>
                    <option value="title_desc">Title Z‚ÜíA</option>
                  </select>
                </div>
                <div class="toggle-controls">
                  <div class="toggle-item">
                    <input type="checkbox" id="hideDupes" class="modern-toggle">
                    <label for="hideDupes" class="toggle-label">Hide duplicates</label>
                  </div>
                  <div class="toggle-item">
                    <input type="checkbox" id="groupModel" class="modern-toggle">
                    <label for="groupModel" class="toggle-label">Group by model</label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Enhanced Data Compare -->
          <div class="filter-tile" data-category="data">
            <div class="tile-header">
              <span class="tile-icon">üìä</span>
              <span class="tile-title">Data Compare</span>
              <span class="active-indicator" id="dataIndicator"></span>
            </div>
            <div class="tile-content">
              <div class="upload-zone" id="uploadZone">
                <input id="csvUpload" type="file" accept=".csv,.xlsx" class="file-input" hidden>
                <div class="upload-content">
                  <span class="upload-icon">üìÑ</span>
                  <span class="upload-text">Drop CSV/XLSX or click to upload</span>
                  <button type="button" class="clear-file-btn" id="clearFileBtn" style="display: none;">‚ü≥ Clear</button>
                </div>
              </div>
              <div class="auto-sync-toggle">
                <input type="checkbox" id="autoSync" class="modern-toggle">
                <label for="autoSync" class="toggle-label">Auto-sync on refresh</label>
              </div>
            </div>
          </div>
        </div>

        <!-- Preset Profiles Section -->
        <div class="preset-section">
          <div class="preset-header">
            <span class="preset-icon">ÔøΩ</span>
            <span class="preset-title">Filter Presets</span>
          </div>
          <div class="preset-controls">
            <select id="presetSelect" class="preset-select">
              <option value="">Select preset...</option>
              <option value="lcd-imports">LCD Imports</option>
              <option value="oem-only">OEM Only</option>
              <option value="refurbished">Refurbished Parts</option>
            </select>
            <button type="button" class="preset-btn" id="savePresetBtn">üíæ Save</button>
            <button type="button" class="preset-btn" id="loadPresetBtn">üìÇ Load</button>
          </div>
        </div>
      </div>

      <!-- Export Actions (Appears after fetch) -->
      <div class="export-actions" id="exportActions" style="display: none;">
        <div class="export-header">
          <div class="export-title">
            <span class="export-icon">üì§</span>
            <span>Export Results</span>
          </div>
          <div id="countBadge" class="result-count">0 items</div>
        </div>
        <div class="export-buttons">
          <button id="csvBtn" class="btn btn-export" disabled>
            <span class="btn-icon">üìä</span>
            CSV
          </button>
          <button id="xlsxBtn" class="btn btn-export" disabled>
            <span class="btn-icon">üìã</span>
            XLSX
          </button>
          <button id="copyBtn" class="btn btn-export" disabled>
            <span class="btn-icon">üìã</span>
            Copy
          </button>
          <button id="clearResultsBtn" class="btn btn-clear" title="Clear all results and reset">
            <span class="btn-icon">üóëÔ∏è</span>
            Clear
          </button>
        </div>
      </div>

      <div class="control-hint">
        <span class="hint-icon">üí°</span>
        <span>Tip: Advanced filters apply in real-time. Use keywords for instant filtering of results.</span>
      </div>
    </section>

    <div id="alert" class="alert cy-card d-none p-3" role="alert"></div>

    <!-- search + watchlist -->
    <section class="cy-card p-2 mb-3">
      <div class="section-heading">
        <h2 class="section-title">Search &amp; Watchlist</h2>
        <p class="section-subtitle">Refine scraped rows instantly or export your starred items.</p>
      </div>
      <div class="fieldset-grid search-grid">
        <div class="fieldset-card">
          <div class="fieldset-title">Quick Search</div>
          <label class="form-label">Search</label>
          <input id="search" class="form-control" placeholder="Title or URL">
        </div>
        <div class="fieldset-card">
          <div class="fieldset-title">Watchlist Tools</div>
          <div class="option-stack mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="showWatchlistOnly">
              <label class="form-check-label" for="showWatchlistOnly">Show watchlist ‚òÖ only</label>
            </div>
            <div class="watchlist-count">
              <span>Tracked:</span>
              <strong id="heroWatchCount">0</strong>
            </div>
          </div>
          <button id="exportWatchlistBtn" class="btn btn-ghost w-100">Export Watchlist</button>
          <button id="clearWatchlistBtn" class="btn btn-ghost danger w-100 mt-2" disabled>Clear Watchlist</button>
        </div>
      </div>
    </section>

    <!-- table -->
    <section class="cy-card results-card">
      <div class="section-heading table-heading results-head">
        <div class="results-title">
          <h2 class="section-title">Results</h2>
          <p class="section-subtitle">Rows update as you tweak filters. Star items to track future drops.</p>
        </div>
        <div class="results-toolbar">
          <nav id="modelChipWrap" class="chip-scroll" aria-label="Current models" hidden></nav>
          <div class="page-size-pill">
            <label for="pageSize" class="page-size-label">Results per page</label>
            <select id="pageSize">
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
      </div>
      <div class="results-shell">
        <div class="results-table">
          <table class="table align-middle" id="resultsTable">
            <thead>
              <tr>
                <th>#</th>
                <th>‚òÖ</th>
                <th>Product</th>
                <th>Pricing</th>
                <th>Change</th>
                <th>Stock</th>
                <th>Source</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="results-empty d-none" id="resultsEmpty">
          <div class="empty-glow" aria-hidden="true"></div>
          <h3>No results yet</h3>
          <p>Run a fetch or adjust filters to populate the table.</p>
        </div>
        <div class="results-footer d-none" id="resultsFooter">
          <div class="page-info" id="pageInfo">Page 1 of 1</div>
          <div class="results-footer__actions">
            <button type="button" id="prevPage" disabled>Prev</button>
            <button type="button" id="nextPage" disabled>Next</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Advanced Loading Overlay -->
  <div id="loading" class="overlay d-none">
    <div class="loading-container">
      <!-- Loading Icon -->
      <div class="loading-icon">‚ö°</div>
      
      <!-- Progress Information -->
      <div class="progress-info">
        <div class="loading-text">Initializing...</div>
        <div class="loading-message">Preparing to fetch data</div>
      </div>
      
      <!-- Advanced Progress Bar with Percentage -->
      <div class="progress-wrapper">
        <div class="progress-header">
          <span>Progress</span>
          <span class="progress-percentage">0%</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar"></div>
        </div>
        
        <!-- Timer Display -->
        <div class="loading-timer">
          <span class="timer-label">Elapsed:</span>
          <span class="timer-value">0.0s</span>
        </div>
      </div>
      
      <!-- Status Steps -->
      <div class="loading-steps">
        <div class="loading-step"></div>
        <div class="loading-step"></div>
        <div class="loading-step"></div>
        <div class="loading-step"></div>
        <div class="loading-step"></div>
        <div class="loading-step"></div>
        <div class="loading-step"></div>
      </div>
    </div>
  </div>

  <!-- Custom Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="row">
        <div class="col text-center">
          <!-- Footer content removed -->
        </div>
      </div>
    </div>
  </footer>

  <!-- Deferred JavaScript for non-blocking load -->
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script defer src="{{ url_for('static', filename='js/theme.js') }}"></script>
  <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>

</body>
</html>





